{% extends "layouts/base.html" %}
{% block title %}User Management - NAPSA ERM{% endblock %}

{% block styles %}
<style>
    /* Professional User Management Styles - NAPSA ERM */
    :root {
        --primary-color: #1e40af;
        --accent-color: #3b82f6;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --info-color: #06b6d4;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --border-radius: 12px;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .dashboard-container {
        background: #f5f5f5 !important;
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    /* Page Header */
    .page-header {
        background: #ffffff;
        border-bottom: 1px solid var(--gray-200);
        padding: 2rem 0;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 700;
        color: #000000 !important;
        margin-bottom: 0.5rem;
        letter-spacing: -0.025em;
    }

    .page-subtitle {
        color: var(--gray-600);
        font-size: 1rem;
        margin-bottom: 0;
    }

    /* Metrics Grid */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.75rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        text-align: center;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
    }

    .stat-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .stat-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--gray-600);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-900);
        line-height: 1;
    }

    .stat-card.total .stat-value { color: var(--primary-color); }
    .stat-card.active .stat-value { color: var(--success-color); }
    .stat-card.admin .stat-value { color: var(--warning-color); }
    .stat-card.locked .stat-value { color: var(--danger-color); }

    /* Card Styles */
    .content-card {
        background: #ffffff;
        border: 1px solid var(--gray-200);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
    }

    .card-header {
        background: #ffffff;
        border-bottom: 1px solid var(--gray-200);
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0;
    }

    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
    }

    .table th, .table td {
        vertical-align: middle;
        border-color: var(--gray-200);
    }

    .table thead th {
        background-color: var(--gray-50);
        font-weight: 600;
        color: var(--gray-700);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }

    .btn-group .btn {
        margin-right: 2px;
    }

    .btn-group .btn:last-child {
        margin-right: 0;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
        .metrics-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 576px) {
        .metrics-grid {
            grid-template-columns: 1fr;
        }
        
        .page-header {
            padding: 1rem 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container p-0">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-users"></i> User Management
                </h1>
                <p class="page-subtitle">Manage user accounts, roles, and permissions</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-primary" onclick="addNewUser()">
                    <i class="fas fa-plus"></i> New User
                </button>
                <button class="btn btn-outline-primary" onclick="refreshUsers()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="stat-card total">
                <div class="stat-label">Total Users</div>
                <div class="stat-value" id="totalUsers">0</div>
            </div>
            
            <div class="stat-card active">
                <div class="stat-label">Active Users</div>
                <div class="stat-value" id="activeUsers">0</div>
            </div>
            
            <div class="stat-card admin">
                <div class="stat-label">Admin Users</div>
                <div class="stat-value" id="adminUsers">0</div>
            </div>
            
            <div class="stat-card locked">
                <div class="stat-label">Locked Users</div>
                <div class="stat-value" id="lockedUsers">0</div>
            </div>
        </div>

        <!-- Users Table -->
        <div class="content-card">
            <div class="card-header">
                <h3 class="card-title">Users</h3>
                <div class="card-tools">
                    <div class="input-group input-group-sm" style="width: 250px;">
                        <input type="text" id="userSearch" class="form-control" placeholder="Search users...">
                        <div class="input-group-append">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="usersTable" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Avatar</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Department</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- DataTable will populate this -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit User Modal -->
<div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">Add New User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="userForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userFullName">Full Name *</label>
                                <input type="text" class="form-control" id="userFullName" name="full_name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userUsername">Username *</label>
                                <input type="text" class="form-control" id="userUsername" name="username" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userEmail">Email *</label>
                                <input type="email" class="form-control" id="userEmail" name="email" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userPhone">Phone</label>
                                <input type="tel" class="form-control" id="userPhone" name="phone">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userRole">Role *</label>
                                <select class="form-control" id="userRole" name="role" required>
                                    <option value="">Select Role</option>
                                    <option value="admin">Administrator</option>
                                    <option value="risk_manager">Risk Manager</option>
                                    <option value="risk_owner">Risk Owner</option>
                                    <option value="viewer">Viewer</option>
                                    <option value="auditor">Auditor</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userDepartment">Department</label>
                                <input type="text" class="form-control" id="userDepartment" name="department">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userPosition">Position</label>
                                <input type="text" class="form-control" id="userPosition" name="position">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userIsActive">Status</label>
                                <select class="form-control" id="userIsActive" name="is_active">
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="passwordFields">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userPassword">Password *</label>
                                <input type="password" class="form-control" id="userPassword" name="password" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="userConfirmPassword">Confirm Password *</label>
                                <input type="password" class="form-control" id="userConfirmPassword" name="confirm_password" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveUserBtn">Save User</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this user? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Deactivate Confirmation Modal -->
<div class="modal fade" id="deactivateModal" tabindex="-1" role="dialog" aria-labelledby="deactivateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deactivateModalLabel">Confirm Deactivate</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to deactivate this user? They will not be able to log in until reactivated.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="confirmDeactivateBtn">Deactivate</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Global variables
let usersTable;
let currentUserId = null;
let isEditMode = false;

// Document ready
$(document).ready(function() {
    // Setup CSRF token for AJAX requests
    const csrfToken = $('meta[name=csrf-token]').attr('content');
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrfToken);
            }
        }
    });
    
    initializeTable();
    loadUserStats();
    loadUsers();
    
    // Setup form validation
    setupFormValidation();
    
    // Setup search
    $('#userSearch').on('keyup', function() {
        if (usersTable) {
            usersTable.search(this.value).draw();
        }
    });
});

// Initialize DataTable
function initializeTable() {
    usersTable = $('#usersTable').DataTable({
        responsive: true,
        searching: false,
        paging: true,
        info: true,
        lengthChange: true,
        pageLength: 10,
        data: [], // Start with empty data
        columns: [
            { 
                data: 'avatar', 
                orderable: false,
                width: '60px',
                className: 'text-center'
            },
            { data: 'full_name', title: 'Name' },
            { data: 'email', title: 'Email' },
            { data: 'username', title: 'Username' },
            { 
                data: 'role', 
                title: 'Role',
                orderable: false,
                className: 'text-center'
            },
            { data: 'department', title: 'Department' },
            { 
                data: 'status', 
                title: 'Status',
                orderable: false,
                className: 'text-center'
            },
            { data: 'last_login', title: 'Last Login' },
            { 
                data: 'actions', 
                title: 'Actions',
                orderable: false,
                width: '120px',
                className: 'text-center'
            }
        ],
        order: [[1, 'asc']],
        language: {
            emptyTable: "No users found",
            loadingRecords: "Loading users...",
            processing: "Loading users...",
            zeroRecords: "No users found matching your search"
        }
    });
}

// Load user statistics
function loadUserStats() {
    fetch('/users/api/users/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const stats = data.data;
                document.getElementById('totalUsers').textContent = stats.total_users || 0;
                document.getElementById('activeUsers').textContent = stats.active_users || 0;
                document.getElementById('adminUsers').textContent = stats.admin_users || 0;
                document.getElementById('lockedUsers').textContent = stats.locked_users || 0;
            }
        })
        .catch(error => {
            console.error('Error loading user stats:', error);
        });
}

// Load users
function loadUsers() {
    // Show loading in the table body
    const tableBody = document.querySelector('#usersTable tbody');
    tableBody.innerHTML = `
        <tr>
            <td colspan="9" class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="mt-2">Loading users...</p>
            </td>
        </tr>
    `;
    
    fetch('/users/api/users')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const users = data.data || [];
                const formattedUsers = users.map(user => ({
                    id: user.id,
                    avatar: generateAvatar(user.full_name),
                    full_name: user.full_name || 'N/A',
                    email: user.email,
                    username: user.username,
                    role: formatRole(user.role),
                    department: user.department || 'N/A',
                    status: formatStatus(user.is_active, user.locked_until),
                    last_login: formatDate(user.last_login),
                    actions: generateActions(user.id, user.username, user.is_active)
                }));
                
                // Clear the loading message first
                tableBody.innerHTML = '';
                usersTable.clear().rows.add(formattedUsers).draw();
            } else {
                showNotification('Error loading users: ' + (data.error || 'Unknown error'), 'error');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p class="mt-2">Error loading users</p>
                        </td>
                    </tr>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading users:', error);
            showNotification('Error loading users: ' + error.message, 'error');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="9" class="text-center text-muted">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p class="mt-2">Failed to load users</p>
                    </td>
                </tr>
            `;
        });
}

// Generate avatar HTML
function generateAvatar(fullName) {
    const initials = fullName ? fullName.split(' ').map(n => n[0]).join('').toUpperCase() : '??';
    return `<div class="avatar-circle">${initials}</div>`;
}

// Format role display
function formatRole(role) {
    const roleMap = {
        'admin': '<span class="badge badge-danger">Administrator</span>',
        'risk_manager': '<span class="badge badge-info">Risk Manager</span>',
        'risk_owner': '<span class="badge badge-warning">Risk Owner</span>',
        'viewer': '<span class="badge badge-secondary">Viewer</span>',
        'auditor': '<span class="badge badge-primary">Auditor</span>'
    };
    return roleMap[role] || '<span class="badge badge-light">Unknown</span>';
}

// Format status display
function formatStatus(isActive, lockedUntil) {
    if (lockedUntil && new Date(lockedUntil) > new Date()) {
        return '<span class="badge badge-warning">Locked</span>';
    }
    return isActive ? 
        '<span class="badge badge-success">Active</span>' : 
        '<span class="badge badge-secondary">Inactive</span>';
}

// Format date
function formatDate(dateString) {
    if (!dateString) return 'Never';
    return new Date(dateString).toLocaleDateString();
}

// Generate action buttons
function generateActions(userId, username, isActive) {
    const deactivateBtn = isActive ? 
        `<button class="btn btn-sm btn-outline-warning" onclick="deactivateUser('${userId}', '${username}')" title="Deactivate">
            <i class="fas fa-user-slash"></i>
        </button>` :
        `<button class="btn btn-sm btn-outline-success" onclick="activateUser('${userId}', '${username}')" title="Activate">
            <i class="fas fa-user-check"></i>
        </button>`;
        
    return `
        <div class="btn-group" role="group">
            <button class="btn btn-sm btn-outline-primary" onclick="editUser('${userId}')" title="Edit">
                <i class="fas fa-edit"></i>
            </button>
            ${deactivateBtn}
            <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${userId}', '${username}')" title="Delete">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
}

// Add new user
function addNewUser() {
    isEditMode = false;
    currentUserId = null;
    document.getElementById('userModalLabel').textContent = 'Add New User';
    document.getElementById('saveUserBtn').textContent = 'Save User';
    document.getElementById('userForm').reset();
    document.getElementById('passwordFields').style.display = 'block';
    document.getElementById('userPassword').required = true;
    document.getElementById('userConfirmPassword').required = true;
    $('#userModal').modal('show');
}

// Edit user
function editUser(userId) {
    isEditMode = true;
    currentUserId = userId;
    document.getElementById('userModalLabel').textContent = 'Edit User';
    document.getElementById('saveUserBtn').textContent = 'Update User';
    document.getElementById('passwordFields').style.display = 'none';
    document.getElementById('userPassword').required = false;
    document.getElementById('userConfirmPassword').required = false;
    
    // Fetch user data from server to populate form
    fetch(`/users/api/users?skip=0&limit=1000`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const user = data.data.find(u => u.id === userId);
                if (user) {
                    // Populate form fields
                    document.getElementById('userFullName').value = user.full_name || '';
                    document.getElementById('userUsername').value = user.username || '';
                    document.getElementById('userEmail').value = user.email || '';
                    document.getElementById('userPhone').value = user.phone || '';
                    document.getElementById('userRole').value = user.role || '';
                    document.getElementById('userDepartment').value = user.department || '';
                    document.getElementById('userPosition').value = user.position || '';
                    document.getElementById('userIsActive').value = user.is_active ? 'true' : 'false';
                    
                    $('#userModal').modal('show');
                } else {
                    showNotification('User not found', 'error');
                }
            } else {
                showNotification('Error fetching user data: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error fetching user data:', error);
            showNotification('Error fetching user data', 'error');
        });
}

// Delete user
function deleteUser(userId, username) {
    currentUserId = userId;
    document.querySelector('#deleteModal .modal-body').innerHTML = 
        `Are you sure you want to delete user <strong>${username}</strong>? This action cannot be undone.`;
    $('#deleteModal').modal('show');
}

// Deactivate user
function deactivateUser(userId, username) {
    currentUserId = userId;
    document.querySelector('#deactivateModal .modal-body').innerHTML = 
        `Are you sure you want to deactivate user <strong>${username}</strong>? They will not be able to log in until reactivated.`;
    $('#deactivateModal').modal('show');
}

// Activate user
function activateUser(userId, username) {
    if (userId) {
        const updateData = { is_active: true };
        
        fetch(`/users/api/users/${userId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updateData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(`User ${username} activated successfully`, 'success');
                loadUsers();
                loadUserStats();
            } else {
                showNotification('Error activating user: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error activating user:', error);
            showNotification('Error activating user', 'error');
        });
    }
}

// Confirm delete
document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    if (currentUserId) {
        fetch(`/users/api/users/${currentUserId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('User deleted successfully', 'success');
                loadUsers();
                loadUserStats();
                $('#deleteModal').modal('hide');
            } else {
                showNotification('Error deleting user: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error deleting user:', error);
            showNotification('Error deleting user', 'error');
        });
    }
});

// Confirm deactivate
document.getElementById('confirmDeactivateBtn').addEventListener('click', function() {
    if (currentUserId) {
        const updateData = { is_active: false };
        
        fetch(`/users/api/users/${currentUserId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updateData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('User deactivated successfully', 'success');
                loadUsers();
                loadUserStats();
                $('#deactivateModal').modal('hide');
            } else {
                showNotification('Error deactivating user: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error deactivating user:', error);
            showNotification('Error deactivating user', 'error');
        });
    }
});

// Setup form validation
function setupFormValidation() {
    document.getElementById('userForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const userData = Object.fromEntries(formData);
        
        // Validate passwords match (if in add mode)
        if (!isEditMode) {
            if (userData.password !== userData.confirm_password) {
                showNotification('Passwords do not match', 'error');
                return;
            }
        }
        
        // Remove confirm_password from data
        delete userData.confirm_password;
        
        // Convert is_active to boolean
        userData.is_active = userData.is_active === 'true';
        
        const url = isEditMode ? `/users/api/users/${currentUserId}` : '/users/api/users';
        const method = isEditMode ? 'PUT' : 'POST';
        
        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message || (isEditMode ? 'User updated successfully' : 'User created successfully'), 'success');
                loadUsers();
                loadUserStats();
                $('#userModal').modal('hide');
            } else {
                showNotification('Error saving user: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error saving user:', error);
            showNotification('Error saving user', 'error');
        });
    });
}

// Refresh users
function refreshUsers() {
    loadUsers();
    loadUserStats();
    showNotification('Users refreshed', 'success');
}

// Show notification
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '9999';
    notification.style.minWidth = '300px';
    
    notification.innerHTML = `
        ${message}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}
</script>
{% endblock %}