{% extends "layouts/base.html" %}

{% block title %}Key Risk Indicators (KRI){% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="page-title">Key Risk Indicators</h1>
                <div class="text-muted">Monitor and track risk metrics in real-time</div>
            </div>
            <div class="col-auto">
                <div class="btn-group" role="group">
                    <a href="{{ url_for('kri.dashboard') }}" class="btn btn-primary">
                        <i class="ti ti-dashboard"></i> KRI Dashboard
                    </a>
                    <a href="{{ url_for('kri.new_kri') }}" class="btn btn-success">
                        <i class="ti ti-plus"></i> New KRI
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- KRI Summary Cards -->
    <div class="row row-cards mb-4">
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="subheader">Total KRIs</div>
                    </div>
                    <div class="h1 mb-3">12</div>
                    <div class="d-flex mb-2">
                        <div>Active indicators</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="subheader">Breached</div>
                    </div>
                    <div class="h1 mb-3 text-danger">3</div>
                    <div class="d-flex mb-2">
                        <div>Above threshold</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="subheader">Warning</div>
                    </div>
                    <div class="h1 mb-3 text-warning">5</div>
                    <div class="d-flex mb-2">
                        <div>Approaching limits</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="subheader">Compliance</div>
                    </div>
                    <div class="h1 mb-3 text-success">75%</div>
                    <div class="d-flex mb-2">
                        <div>Within thresholds</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- KRI Table -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Key Risk Indicators</h3>
            <div class="card-actions">
                <div class="input-group">
                    <input type="text" class="form-control form-control-sm" placeholder="Search KRIs...">
                    <button class="btn btn-sm btn-primary" type="button">
                        <i class="ti ti-search"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-vcenter card-table">
                <thead>
                    <tr>
                        <th>KRI Name</th>
                        <th>Category</th>
                        <th>Current Value</th>
                        <th>Threshold</th>
                        <th>Status</th>
                        <th>Trend</th>
                        <th>Frequency</th>
                        <th>Last Updated</th>
                        <th class="w-1"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="text-reset">System Uptime</div>
                            <div class="text-muted">System Availability Risk</div>
                        </td>
                        <td>Operational</td>
                        <td><strong>99.95%</strong></td>
                        <td>>99.9%</td>
                        <td>
                            <span class="badge bg-success">Normal</span>
                        </td>
                        <td>
                            <i class="ti ti-arrow-right text-muted"></i> Stable
                        </td>
                        <td>Daily</td>
                        <td>2 mins ago</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm" data-bs-toggle="dropdown">
                                    <i class="ti ti-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">View Details</a>
                                    <a class="dropdown-item" href="#">Edit</a>
                                    <a class="dropdown-item" href="#">View History</a>
                                    <a class="dropdown-item text-danger" href="#">Delete</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="text-reset">Failed Login Attempts</div>
                            <div class="text-muted">Cyber Security Risk</div>
                        </td>
                        <td>Security</td>
                        <td><strong>45</strong></td>
                        <td><50</td>
                        <td>
                            <span class="badge bg-warning">Warning</span>
                        </td>
                        <td>
                            <i class="ti ti-arrow-up text-danger"></i> Increasing
                        </td>
                        <td>Hourly</td>
                        <td>5 mins ago</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm" data-bs-toggle="dropdown">
                                    <i class="ti ti-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">View Details</a>
                                    <a class="dropdown-item" href="#">Edit</a>
                                    <a class="dropdown-item" href="#">View History</a>
                                    <a class="dropdown-item text-danger" href="#">Delete</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="text-reset">Payment Processing Time</div>
                            <div class="text-muted">Transaction Processing Risk</div>
                        </td>
                        <td>Operational</td>
                        <td><strong>8.5 sec</strong></td>
                        <td><4 sec</td>
                        <td>
                            <span class="badge bg-danger">Breached</span>
                        </td>
                        <td>
                            <i class="ti ti-arrow-up text-danger"></i> Increasing
                        </td>
                        <td>Daily</td>
                        <td>10 mins ago</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm" data-bs-toggle="dropdown">
                                    <i class="ti ti-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#">View Details</a>
                                    <a class="dropdown-item" href="#">Edit</a>
                                    <a class="dropdown-item" href="#">View History</a>
                                    <a class="dropdown-item text-danger" href="#">Delete</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- New KRI Modal -->
<div class="modal fade" id="newKRIModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New KRI</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="newKRIForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">KRI Name</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <option value="">Select Category</option>
                                <option value="operational">Operational</option>
                                <option value="financial">Financial</option>
                                <option value="compliance">Compliance</option>
                                <option value="security">Security</option>
                                <option value="strategic">Strategic</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" rows="2"></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Associated Risk</label>
                            <select class="form-select" name="risk_id">
                                <option value="">Select Risk</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Measurement Unit</label>
                            <input type="text" class="form-control" name="unit" placeholder="e.g., %, count, seconds">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Green Threshold</label>
                            <input type="number" class="form-control" name="threshold_green" step="0.01">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Amber Threshold</label>
                            <input type="number" class="form-control" name="threshold_amber" step="0.01">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Red Threshold</label>
                            <input type="number" class="form-control" name="threshold_red" step="0.01">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Monitoring Frequency</label>
                            <select class="form-select" name="frequency">
                                <option value="realtime">Real-time</option>
                                <option value="hourly">Hourly</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Data Source</label>
                            <input type="text" class="form-control" name="data_source" placeholder="e.g., System logs, API, Manual">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveKRI()">Create KRI</button>
            </div>
        </div>
    </div>
</div>

<script>
function saveKRI() {
    // Placeholder for KRI save functionality
    alert('KRI creation functionality will be implemented');
    $('#newKRIModal').modal('hide');
}
</script>
{% endblock %}