{% extends "layouts/base.html" %}

{% block title %}Risk Management Process Flow - NAPSA ERM{% endblock %}

{% block styles %>
<style>
    :root {
        --sidebar-color: #1e3a8a;
        --orange-hover: #f59e0b;
        --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }

    .process-container {
        padding: 2rem;
    }

    .btn-primary, .btn-secondary, .btn-outline-primary, .btn-outline-success, 
    .btn-outline-warning, .btn-outline-info {
        background: var(--sidebar-color) !important;
        border-color: var(--sidebar-color) !important;
        color: white !important;
        padding: 0.5rem 1.25rem;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary:hover, .btn-secondary:hover, .btn-outline-primary:hover, 
    .btn-outline-success:hover, .btn-outline-warning:hover, .btn-outline-info:hover {
        background: var(--orange-hover) !important;
        border-color: var(--orange-hover) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    
    .process-flow {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        margin-bottom: 2rem;
    }
    
    .flow-step {
        position: relative;
        padding: 2rem;
        border-left: 4px solid var(--sidebar-color);
        margin-left: 2rem;
        margin-bottom: 2rem;
        background: white;
        border-radius: 8px;
    }
    
    .flow-step::before {
        content: attr(data-step);
        position: absolute;
        left: -45px;
        top: 1.5rem;
        width: 50px;
        height: 50px;
        background: var(--sidebar-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
    }
    
    .flow-step.current {
        border-left-color: #10b981;
        background: #f0fdf4;
    }
    
    .flow-step.current::before {
        background: #10b981;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    .flow-step h3 {
        color: #1f2937;
        margin-bottom: 1rem;
        font-size: 1.25rem;
    }
    
    .flow-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .flow-action {
        padding: 0.5rem 1rem;
        background: var(--sidebar-color);
        color: white;
        border: 1px solid var(--sidebar-color);
        border-radius: 8px;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .flow-action:hover {
        background: var(--orange-hover);
        border-color: var(--orange-hover);
        transform: translateY(-2px);
    }
    
    .role-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-right: 0.5rem;
    }
    
    .role-admin { background: #fee2e2; color: #991b1b; }
    .role-manager { background: #e0e7ff; color: #3730a3; }
    .role-owner { background: #fef3c7; color: #92400e; }
    .role-auditor { background: #d1fae5; color: #065f46; }
    
    .decision-point {
        background: #fef3c7;
        border: 2px dashed #f59e0b;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    
    .timeline-view {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 2rem;
        margin-top: 2rem;
    }
    
    .timeline-stages {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .stage-item {
        padding: 1rem;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .stage-item.active {
        border-color: var(--sidebar-color);
        background: #eff6ff;
    }
    
    .stage-item:hover {
        transform: translateX(4px);
    }
    
    .process-diagram {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .flow-connector {
        position: absolute;
        background: #e5e7eb;
        height: 2px;
    }
    
    .flow-node {
        position: absolute;
        background: white;
        border: 3px solid var(--sidebar-color);
        border-radius: 12px;
        padding: 1rem;
        min-width: 150px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
    }
    
    .flow-node:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .flow-node.start { border-color: #10b981; background: #f0fdf4; }
    .flow-node.end { border-color: #ef4444; background: #fef2f2; }
    .flow-node.decision { 
        border-color: #f59e0b; 
        background: #fffbeb;
        transform: rotate(45deg);
    }
    .flow-node.decision .node-content {
        transform: rotate(-45deg);
    }
    
    .help-section {
        background: #f0f9ff;
        border-left: 4px solid var(--sidebar-color);
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
    }
    
    .checklist {
        list-style: none;
        padding: 0;
    }
    
    .checklist li {
        padding: 0.5rem 0;
        padding-left: 2rem;
        position: relative;
    }
    
    .checklist li::before {
        content: "✓";
        position: absolute;
        left: 0;
        color: #10b981;
        font-weight: 700;
    }
    
    .best-practice {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .warning-box {
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-left: 4px solid #ef4444;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
    }

    .stat-card:nth-child(1) .card-body::before {
        background: var(--gradient-1);
    }

    .stat-card:nth-child(2) .card-body::before {
        background: var(--gradient-2);
    }

    .stat-card:nth-child(3) .card-body::before {
        background: var(--gradient-3);
    }

    .stat-card:nth-child(4) .card-body::before {
        background: var(--gradient-4);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .stat-card:nth-child(1) .stat-icon {
        background: var(--gradient-1);
    }

    .stat-card:nth-child(2) .stat-icon {
        background: var(--gradient-2);
    }

    .stat-card:nth-child(3) .stat-icon {
        background: var(--gradient-3);
    }

    .stat-card:nth-child(4) .stat-icon {
        background: var(--gradient-4);
    }
</style>
{% endblock %}

{% block content %}
<div class="process-container">
    <!-- Action Buttons -->
    <div class="mb-4">
        <button class="btn btn-primary" onclick="showHelp('identification')">
            <i class="fas fa-plus me-2"></i>New Risk
        </button>
        <button class="btn btn-secondary ms-2" onclick="scrollToSection('process-flow')">
            <i class="fas fa-stream me-1"></i>View Process
        </button>
        <button class="btn btn-secondary ms-2" onclick="printProcessFlow()">
            <i class="fas fa-print me-1"></i>Print Guide
        </button>
        <button class="btn btn-secondary ms-2" onclick="exportAsPDF()">
            <i class="fas fa-file-pdf me-1"></i>Export PDF
        </button>
    </div>

    <!-- Quick Navigation -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mx-auto">
                        <i class="fas fa-play-circle fa-2x text-white"></i>
                    </div>
                    <h5>Getting Started</h5>
                    <button class="btn btn-sm btn-primary mt-2" onclick="scrollToSection('getting-started')">
                        View Guide
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mx-auto">
                        <i class="fas fa-project-diagram fa-2x text-white"></i>
                    </div>
                    <h5>Process Flow</h5>
                    <button class="btn btn-sm btn-primary mt-2" onclick="scrollToSection('process-flow')">
                        View Flow
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mx-auto">
                        <i class="fas fa-user-shield fa-2x text-white"></i>
                    </div>
                    <h5>Role Guide</h5>
                    <button class="btn btn-sm btn-primary mt-2" onclick="scrollToSection('role-guide')">
                        View Roles
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="card-body text-center">
                    <div class="stat-icon mx-auto">
                        <i class="fas fa-lightbulb fa-2x text-white"></i>
                    </div>
                    <h5>Best Practices</h5>
                    <button class="btn btn-sm btn-primary mt-2" onclick="scrollToSection('best-practices')">
                        View Tips
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Process Flow -->
    <div class="process-flow" id="process-flow">
        <h2 class="mb-4">
            <i class="fas fa-stream mr-2"></i>
            Risk Management Lifecycle
        </h2>
        
        <!-- Interactive Process Steps -->
        <div class="flow-step" data-step="1">
            <h3>Risk Identification</h3>
            <p>Identify and document potential risks that could impact organizational objectives.</p>
            
            <div class="help-section">
                <strong>Key Activities:</strong>
                <ul class="checklist">
                    <li>Conduct risk workshops and brainstorming sessions</li>
                    <li>Review historical incidents and near-misses</li>
                    <li>Analyze industry trends and regulatory changes</li>
                    <li>Interview stakeholders and subject matter experts</li>
                </ul>
            </div>
            
            <div class="flow-actions">
                <span class="role-badge role-manager">Risk Manager</span>
                <span class="role-badge role-owner">Risk Owner</span>
                <button class="flow-action" onclick="showHelp('identification')">
                    <i class="fas fa-plus mr-1"></i> Create New Risk
                </button>
                <button class="flow-action" onclick="showHelp('import')">
                    <i class="fas fa-upload mr-1"></i> Import Risks
                </button>
            </div>
        </div>

        <div class="flow-step current" data-step="2">
            <h3>Risk Assessment</h3>
            <p>Evaluate identified risks based on likelihood and impact using standardized scales.</p>
            
            <div class="help-section">
                <strong>Assessment Criteria:</strong>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <h6>Impact Scale (1-5)</h6>
                        <small>1: Negligible → 5: Catastrophic</small>
                    </div>
                    <div class="col-md-6">
                        <h6>Likelihood Scale (1-5)</h6>
                        <small>1: Rare → 5: Almost Certain</small>
                    </div>
                </div>
            </div>
            
            <div class="decision-point">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <strong>Decision Point:</strong> Risk Score = Impact × Likelihood
                <div class="mt-2">
                    • Score 1-5: Low Risk (Green)<br>
                    • Score 6-10: Medium Risk (Yellow)<br>
                    • Score 11-15: High Risk (Orange)<br>
                    • Score 16-25: Critical Risk (Red)
                </div>
            </div>
            
            <div class="flow-actions">
                <span class="role-badge role-owner">Risk Owner</span>
                <button class="flow-action" onclick="showHelp('assessment')">
                    <i class="fas fa-calculator mr-1"></i> Assess Risk
                </button>
                <button class="flow-action" onclick="showHelp('matrix')">
                    <i class="fas fa-th mr-1"></i> View Risk Matrix
                </button>
            </div>
        </div>

        <div class="flow-step" data-step="3">
            <h3>Risk Response Planning</h3>
            <p>Develop and implement strategies to address identified risks.</p>
            
            <div class="help-section">
                <strong>Response Strategies:</strong>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <div class="mb-2">
                            <i class="fas fa-ban text-danger"></i> <strong>Avoid:</strong> Eliminate the risk
                        </div>
                        <div class="mb-2">
                            <i class="fas fa-compress-alt text-warning"></i> <strong>Mitigate:</strong> Reduce impact/likelihood
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-2">
                            <i class="fas fa-exchange-alt text-info"></i> <strong>Transfer:</strong> Shift risk to third party
                        </div>
                        <div class="mb-2">
                            <i class="fas fa-check-circle text-success"></i> <strong>Accept:</strong> Acknowledge and monitor
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flow-actions">
                <span class="role-badge role-manager">Risk Manager</span>
                <button class="flow-action" onclick="showHelp('controls')">
                    <i class="fas fa-shield-alt mr-1"></i> Add Controls
                </button>
                <button class="flow-action" onclick="showHelp('treatment')">
                    <i class="fas fa-pills mr-1"></i> Create Treatment Plan
                </button>
            </div>
        </div>

        <div class="flow-step" data-step="4">
            <h3>Implementation & Monitoring</h3>
            <p>Execute risk treatment plans and continuously monitor risk status.</p>
            
            <div class="help-section">
                <strong>Monitoring Activities:</strong>
                <ul class="checklist">
                    <li>Track control effectiveness</li>
                    <li>Monitor key risk indicators (KRIs)</li>
                    <li>Review risk triggers and early warning signs</li>
                    <li>Update risk assessments periodically</li>
                </ul>
            </div>
            
            <div class="flow-actions">
                <span class="role-badge role-owner">Risk Owner</span>
                <button class="flow-action" onclick="showHelp('monitoring')">
                    <i class="fas fa-chart-line mr-1"></i> View Dashboard
                </button>
                <button class="flow-action" onclick="showHelp('kri')">
                    <i class="fas fa-tachometer-alt mr-1"></i> Set KRIs
                </button>
            </div>
        </div>

        <div class="flow-step" data-step="5">
            <h3>Review & Reporting</h3>
            <p>Regular review of risk management effectiveness and reporting to stakeholders.</p>
            
            <div class="help-section">
                <strong>Review Frequency:</strong>
                <div class="mt-2">
                    • Critical Risks: Monthly<br>
                    • High Risks: Quarterly<br>
                    • Medium Risks: Semi-annually<br>
                    • Low Risks: Annually
                </div>
            </div>
            
            <div class="flow-actions">
                <span class="role-badge role-auditor">Auditor</span>
                <span class="role-badge role-admin">Admin</span>
                <button class="flow-action" onclick="showHelp('reports')">
                    <i class="fas fa-file-pdf mr-1"></i> Generate Reports
                </button>
                <button class="flow-action" onclick="showHelp('audit')">
                    <i class="fas fa-clipboard-check mr-1"></i> Audit Trail
                </button>
            </div>
        </div>
    </div>

    <!-- Role-Based Guide -->
    <div class="process-flow" id="role-guide">
        <h2 class="mb-4">
            <i class="fas fa-users mr-2"></i>
            Role-Based Responsibilities
        </h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header bg-danger text-white">
                        <i class="fas fa-user-shield mr-2"></i> Administrator
                    </div>
                    <div class="card-body">
                        <ul class="checklist">
                            <li>System configuration and user management</li>
                            <li>Define risk scales and matrices</li>
                            <li>Set organizational risk appetite</li>
                            <li>Configure workflows and approvals</li>
                            <li>Generate executive reports</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-user-tie mr-2"></i> Risk Manager
                    </div>
                    <div class="card-body">
                        <ul class="checklist">
                            <li>Oversee risk identification process</li>
                            <li>Review and validate risk assessments</li>
                            <li>Develop risk treatment strategies</li>
                            <li>Monitor risk portfolio</li>
                            <li>Coordinate risk reviews</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header bg-warning text-dark">
                        <i class="fas fa-user mr-2"></i> Risk Owner
                    </div>
                    <div class="card-body">
                        <ul class="checklist">
                            <li>Identify risks in area of responsibility</li>
                            <li>Perform risk assessments</li>
                            <li>Implement control measures</li>
                            <li>Monitor and update risk status</li>
                            <li>Report on risk progress</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-user-check mr-2"></i> Auditor
                    </div>
                    <div class="card-body">
                        <ul class="checklist">
                            <li>Review risk management processes</li>
                            <li>Verify control effectiveness</li>
                            <li>Conduct compliance checks</li>
                            <li>Review audit trails</li>
                            <li>Provide assurance reports</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Best Practices -->
    <div class="process-flow" id="best-practices">
        <h2 class="mb-4">
            <i class="fas fa-star mr-2"></i>
            Best Practices & Tips
        </h2>
        
        <div class="best-practice">
            <h5><i class="fas fa-check-circle text-success mr-2"></i> Risk Identification</h5>
            <p>Use multiple sources: workshops, interviews, document reviews, and industry benchmarks. Don't rely on a single method.</p>
        </div>
        
        <div class="best-practice">
            <h5><i class="fas fa-check-circle text-success mr-2"></i> Assessment Consistency</h5>
            <p>Use standardized scales and criteria across the organization. Provide clear definitions and examples for each rating level.</p>
        </div>
        
        <div class="best-practice">
            <h5><i class="fas fa-check-circle text-success mr-2"></i> Documentation</h5>
            <p>Maintain comprehensive documentation including rationale for assessments, evidence, and decision justifications.</p>
        </div>
        
        <div class="best-practice">
            <h5><i class="fas fa-check-circle text-success mr-2"></i> Regular Reviews</h5>
            <p>Schedule regular risk reviews based on risk levels. Don't wait for annual reviews to update critical risks.</p>
        </div>
        
        <div class="warning-box">
            <h5><i class="fas fa-exclamation-triangle text-danger mr-2"></i> Common Pitfalls to Avoid</h5>
            <ul>
                <li>Assessing risks in isolation without considering interdependencies</li>
                <li>Focusing only on negative risks and ignoring opportunities</li>
                <li>Setting and forgetting - risks need continuous monitoring</li>
                <li>Over-relying on historical data without considering emerging risks</li>
            </ul>
        </div>
    </div>

    <!-- Quick Reference -->
    <div class="process-flow">
        <h2 class="mb-4">
            <i class="fas fa-bookmark mr-2"></i>
            Quick Reference
        </h2>
        
        <div class="row">
            <div class="col-md-4">
                <h5>Keyboard Shortcuts</h5>
                <table class="table table-sm">
                    <tr><td><kbd>Alt</kbd> + <kbd>N</kbd></td><td>New Risk</td></tr>
                    <tr><td><kbd>Alt</kbd> + <kbd>S</kbd></td><td>Save</td></tr>
                    <tr><td><kbd>Alt</kbd> + <kbd>R</kbd></td><td>Refresh</td></tr>
                    <tr><td><kbd>Alt</kbd> + <kbd>H</kbd></td><td>Help</td></tr>
                </table>
            </div>
            
            <div class="col-md-4">
                <h5>Risk Score Matrix</h5>
                <table class="table table-sm table-bordered text-center">
                    <tr>
                        <td></td>
                        <td>1</td><td>2</td><td>3</td><td>4</td><td>5</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td class="bg-warning">5</td>
                        <td class="bg-warning">10</td>
                        <td class="bg-danger">15</td>
                        <td class="bg-danger">20</td>
                        <td class="bg-danger">25</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td class="bg-success">4</td>
                        <td class="bg-warning">8</td>
                        <td class="bg-warning">12</td>
                        <td class="bg-danger">16</td>
                        <td class="bg-danger">20</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td class="bg-success">3</td>
                        <td class="bg-warning">6</td>
                        <td class="bg-warning">9</td>
                        <td class="bg-warning">12</td>
                        <td class="bg-danger">15</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td class="bg-success">2</td>
                        <td class="bg-success">4</td>
                        <td class="bg-warning">6</td>
                        <td class="bg-warning">8</td>
                        <td class="bg-warning">10</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td class="bg-success">1</td>
                        <td class="bg-success">2</td>
                        <td class="bg-success">3</td>
                        <td class="bg-success">4</td>
                        <td class="bg-success">5</td>
                    </tr>
                </table>
            </div>
            
            <div class="col-md-4">
                <h5>Support Resources</h5>
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-book mr-2"></i> User Manual
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-video mr-2"></i> Video Tutorials
                    </a>
                    <a href="#" class="list-group-item list-group-item-action">
                        <i class="fas fa-headset mr-2"></i> Contact Support
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-question-circle mr-2"></i>
                    <span id="helpTitle">Help</span>
                </h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="helpContent">
                <!-- Dynamic help content -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Help content database
const helpContent = {
    identification: {
        title: 'Risk Identification Guide',
        content: `
            <h5>How to Identify Risks</h5>
            <ol>
                <li><strong>Navigate to Risk Register:</strong> Click on "Risks" in the main menu</li>
                <li><strong>Click "Add New Risk":</strong> Located in the top-right corner</li>
                <li><strong>Fill in Risk Details:</strong>
                    <ul>
                        <li>Risk Title: Clear, concise description</li>
                        <li>Category: Select from dropdown</li>
                        <li>Description: Detailed explanation</li>
                        <li>Risk Owner: Assign responsible person</li>
                    </ul>
                </li>
                <li><strong>Save:</strong> Click "Save" to create the risk</li>
            </ol>
            <div class="alert alert-info mt-3">
                <i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Use the risk taxonomy template for consistent categorization.
            </div>
        `
    },
    assessment: {
        title: 'Risk Assessment Guide',
        content: `
            <h5>How to Assess Risks</h5>
            <div class="row">
                <div class="col-md-6">
                    <h6>Impact Assessment</h6>
                    <table class="table table-sm">
                        <tr><td>1</td><td>Negligible impact on objectives</td></tr>
                        <tr><td>2</td><td>Minor impact, easily manageable</td></tr>
                        <tr><td>3</td><td>Moderate impact, some disruption</td></tr>
                        <tr><td>4</td><td>Major impact, significant disruption</td></tr>
                        <tr><td>5</td><td>Catastrophic impact, critical failure</td></tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6>Likelihood Assessment</h6>
                    <table class="table table-sm">
                        <tr><td>1</td><td>Rare (&lt;10% chance)</td></tr>
                        <tr><td>2</td><td>Unlikely (10-30% chance)</td></tr>
                        <tr><td>3</td><td>Possible (30-50% chance)</td></tr>
                        <tr><td>4</td><td>Likely (50-80% chance)</td></tr>
                        <tr><td>5</td><td>Almost Certain (&gt;80% chance)</td></tr>
                    </table>
                </div>
            </div>
            <div class="alert alert-warning mt-3">
                <i class="fas fa-exclamation-triangle"></i> <strong>Important:</strong> Always document the rationale for your assessment ratings.
            </div>
        `
    },
    controls: {
        title: 'Control Management Guide',
        content: `
            <h5>Adding Controls to Risks</h5>
            <p>Controls are measures implemented to reduce risk likelihood or impact.</p>
            
            <h6>Types of Controls:</h6>
            <ul>
                <li><strong>Preventive:</strong> Stop the risk from occurring</li>
                <li><strong>Detective:</strong> Identify when risk events occur</li>
                <li><strong>Corrective:</strong> Fix issues after they occur</li>
                <li><strong>Compensating:</strong> Alternative measures when primary controls aren't feasible</li>
            </ul>
            
            <h6>Control Effectiveness Ratings:</h6>
            <ul>
                <li><span class="badge badge-success">Effective</span> Control is working as designed</li>
                <li><span class="badge badge-warning">Partially Effective</span> Some gaps exist</li>
                <li><span class="badge badge-danger">Not Effective</span> Control is not working</li>
            </ul>
        `
    },
    matrix: {
        title: 'Risk Matrix Guide',
        content: `
            <h5>Understanding the Risk Matrix</h5>
            <p>The risk matrix visualizes risks based on their impact and likelihood scores.</p>
            
            <div class="text-center mb-3">
                <img src="/static/images/risk-matrix-example.png" alt="Risk Matrix" class="img-fluid" style="max-width: 400px;">
            </div>
            
            <h6>Risk Levels:</h6>
            <ul>
                <li><span class="badge badge-success">Low (1-5)</span> Acceptable risk, monitor periodically</li>
                <li><span class="badge badge-warning">Medium (6-10)</span> Management attention required</li>
                <li><span class="badge badge-danger">High (11-15)</span> Senior management attention required</li>
                <li><span class="badge badge-dark">Critical (16-25)</span> Immediate action required</li>
            </ul>
        `
    },
    reports: {
        title: 'Reporting Guide',
        content: `
            <h5>Generating Risk Reports</h5>
            <ol>
                <li>Navigate to Reports section</li>
                <li>Select report type:
                    <ul>
                        <li>Executive Summary</li>
                        <li>Risk Register</li>
                        <li>Risk Assessment Report</li>
                        <li>Control Effectiveness Report</li>
                    </ul>
                </li>
                <li>Choose filters (date range, department, risk level)</li>
                <li>Select format (PDF, Excel, Word)</li>
                <li>Click "Generate Report"</li>
            </ol>
            
            <div class="alert alert-info mt-3">
                <i class="fas fa-clock"></i> Reports are automatically saved in the Document Management section.
            </div>
        `
    }
};

// Show help modal
function showHelp(topic) {
    const help = helpContent[topic] || { title: 'Help', content: 'Help content not available.' };
    $('#helpTitle').text(help.title);
    $('#helpContent').html(help.content);
    $('#helpModal').modal('show');
}

// Scroll to section
function scrollToSection(sectionId) {
    const element = document.getElementById(sectionId);
    if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
    }
}

// Interactive process flow
$(document).ready(function() {
    // Add click handlers to process steps
    $('.flow-step').click(function() {
        $('.flow-step').removeClass('current');
        $(this).addClass('current');
    });
    
    // Keyboard shortcuts
    $(document).keydown(function(e) {
        if (e.altKey) {
            switch(e.key) {
                case 'n': // New risk
                    window.location.href = '/risks/new';
                    break;
                case 'h': // Help
                    $('#helpModal').modal('show');
                    break;
                case 'r': // Refresh
                    location.reload();
                    break;
            }
        }
    });
    
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
});

// Print process flow
function printProcessFlow() {
    window.print();
}

// Export as PDF (requires backend implementation)
function exportAsPDF() {
    alert('Exporting process flow as PDF...');
    // Implementation would call backend API to generate PDF
}
</script>
{% endblock %}